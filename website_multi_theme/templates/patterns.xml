<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2017 Jairo Llopis <jairo.llopis@tecnativa.com>
     License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl.html). -->
<odoo>

    <template id="layout" name="Main layout" inherit_id="portal.frontend_layout">
    <xpath expr="//t[@t-set='head_website']" position="before">
        <t t-set="html_data" t-value="{
            'lang': lang and lang.replace('_', '-'),
            'data-website-id': website.id if website else None,
            'data-editable': '1' if editable else None,
            'data-translatable': '1' if translatable else None,
            'data-edit_translations': '1' if edit_translations else None,
            'data-view-xmlid': xmlid if editable or translatable else None,
            'data-main-object': repr(main_object) if editable or translatable else None,
            'data-oe-company-name': res_company.name
        }"/>
        <t t-if="not title">
            <t t-if="not additional_title and main_object and 'name' in main_object">
                <t t-set="additional_title" t-value="main_object.name"/>
            </t>
            <t t-if="main_object and 'website_meta_title' in main_object and main_object.website_meta_title">
                <t t-set="title" t-value="main_object.website_meta_title"/>
            </t>
            <t t-else="">
                <t t-set="title"><t t-if="additional_title"><t t-raw="additional_title"/> | </t><t t-raw="(website or res_company).name"/></t>
            </t>
        </t>
        <t t-set="x_icon" t-value="'/web/image/website/%s/favicon/' % website.id"/>
    </xpath>
    <xpath expr="//t[@t-set='head_website']" position="replace">
        <t t-set="head_website">
            <meta name="generator" content="Odoo"/>

            <meta t-if="main_object and 'website_indexed' in main_object
                and not main_object.website_indexed" name="robots" content="noindex"/>
            <t t-set="meta_description" t-value="main_object and 'website_meta_description' in main_object
                and main_object.website_meta_description or website_meta_description"/>
            <t t-set="meta_keywords" t-value="main_object and 'website_meta_keywords' in main_object
                and main_object.website_meta_keywords or website_meta_keywords"/>
            <meta t-if="meta_description or editable" name="description" t-att-content="meta_description"/>
            <meta t-if="meta_keywords or editable" name="keywords" t-att-content="meta_keywords"/>

            <!-- OpenGraph tags for Facebook sharing -->
            <meta property="og:title" t-att-content="additional_title" />
            <meta property="og:site_name" t-att-content="res_company.name" />
            <t t-if="main_object and 'plain_content' in main_object and main_object.plain_content">
                <t t-set="og_description" t-value="main_object.plain_content[0:500]"/>
                <meta property="og:description" t-att-content="og_description" />
                <meta property='og:image' t-att-content="request.httprequest.url_root+'logo.png'"/>
                <meta property='og:url' t-att-content="request.httprequest.url_root+request.httprequest.path[1:end]"/>
            </t>

            <t t-set="languages" t-value="website.get_languages() if website else None"/>
            <t t-if="request and request.is_frontend_multilang and website">
                <t t-foreach="website.get_alternate_languages(request.httprequest)" t-as="lg">
                    <link rel="alternate" t-att-hreflang="lg['hreflang']" t-att-href="lg['href']"/>
                </t>
            </t>

            <script type="text/javascript">
                <t groups="website.group_website_publisher">
                    odoo.snippetsURL = '/website/snippets';
                </t>

                odoo.session_info = {
                    is_superuser: <t t-esc="json.dumps(request.env.user._is_superuser())"/>,
                    is_system: <t t-esc="json.dumps(request.env.user._is_system())"/>,
                    is_frontend: true,
                    translationURL: '/website/translations',
                    is_website_user: <t t-esc="json.dumps(request.env.user.id == request.website.user_id.id)" />,
                    user_id: <t t-esc="json.dumps(request.env.user.id)" />
                };
            </script>

            <t t-call-assets="web.assets_common" t-js="false"/>
            <t t-call-assets="web.assets_frontend" t-js="false"/>
            <t t-call-assets="web_editor.summernote" t-js="false" groups="website.group_website_publisher"/>
            <t t-call-assets="web_editor.assets_editor" t-js="false" groups="website.group_website_publisher"/>
            <t t-call-assets="website.assets_editor" t-js="false" groups="website.group_website_publisher"/>

            <t t-call-assets="web.assets_common" t-css="false"/>
            <t t-call-assets="web.assets_frontend" t-css="false"/>
            <t t-call-assets="web_editor.summernote" t-css="false" groups="website.group_website_publisher"/>
            <t t-call-assets="web_editor.assets_editor" t-css="false" groups="website.group_website_publisher"/>
            <t t-call-assets="website.assets_editor" t-css="false" groups="website.group_website_publisher"/>
        </t>
    </xpath>
    <xpath expr="//header//a[hasclass('navbar-brand')]" position="replace">
        <a class="navbar-brand" href="/" t-if="website" t-field="website.name">My Website</a>
    </xpath>
    <xpath expr="//header//ul[@id='top_menu']/li[hasclass('divider')]" position="attributes">
        <attribute name="t-if">website.user_id != user_id</attribute>
    </xpath>
    <xpath expr="//header//ul[@id='top_menu']/li[hasclass('dropdown')]" position="attributes">
        <attribute name="t-if">website.user_id != user_id</attribute>
    </xpath>
    <xpath expr="//header//ul[@id='top_menu']/li[hasclass('divider')]" position="before">
        <t t-foreach="website.menu_id.child_id" t-as="submenu">
            <t t-call="website.submenu"/>
        </t>
    </xpath>
    <xpath expr="//div[@id='wrapwrap']" position="after">
        <script id='tracking_code' t-if="website and website.google_analytics_key and not editable">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', _.str.trim('<t t-esc="website.google_analytics_key"/>'), 'auto');
            ga('send','pageview');
        </script>
    </xpath>
</template>
    
    <template
        id="layout_pattern"
        inherit_id="website.layout"
        name="Main layout"
        active="False">
        <!-- Replace assets to make good use of caching -->
        <xpath expr="//t[@t-call-assets='web.assets_frontend'][@t-js='false']"
               position="attributes">
            <attribute name="t-call-assets">{theme_view}</attribute>
        </xpath>
        <xpath expr="//t[@t-call-assets='web.assets_frontend'][@t-css='false']"
               position="attributes">
            <attribute name="t-call-assets">{theme_view}</attribute>
        </xpath>
    </template>

    <template
        id="assets_pattern"
        inherit_id="website.assets_frontend"
        name="Empty assets_frontend pattern"
        primary="True"
        active="False">
        <xpath expr="."/>
    </template>

</odoo>
